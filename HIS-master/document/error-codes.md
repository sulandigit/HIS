# HIS-master 错误码文档

## 文档信息
- **版本**：v1.0.0
- **更新时间**：2025-11-03
- **适用系统**：HIS-master（单体应用）
- **维护团队**：后端开发团队

---

## 一、错误码规范

### 1.1 错误码结构

采用6位数字错误码，结构说明：

| 字段 | 位数 | 说明 | 示例 |
|------|------|------|------|
| 完整错误码 | 6位 | 整体结构 | 100001 |
| 模块码 | 前2位 | 标识所属业务模块 | 10 |
| 分类码 | 中2位 | 标识错误类型分类 | 00 |
| 序号码 | 后2位 | 同类错误的序号 | 01 |

### 1.2 错误响应格式

所有接口返回统一的CommonResult格式：

```java
public class CommonResult<T> {
    private long code;      // 错误码
    private String message; // 错误信息
    private T data;         // 响应数据
}
```

---

## 二、错误码列表

### 2.1 系统通用错误码(000000-009999)

#### 成功状态

| 错误码 | 错误信息 | HTTP状态码 | 枚举常量 | 说明 |
|--------|----------|-----------|---------|------|
| 000000 | 操作成功 | 200 | SUCCESS | 请求处理成功 |

#### 认证授权错误(000101-000199)

| 错误码 | 错误信息 | HTTP状态码 | 枚举常量 | 说明 |
|--------|----------|-----------|---------|------|
| 000101 | 暂未登录或token已经过期 | 401 | UNAUTHORIZED | 认证失败 |
| 000102 | 没有相关权限 | 403 | FORBIDDEN | 授权失败 |

#### 参数校验错误(000201-000299)

| 错误码 | 错误信息 | HTTP状态码 | 枚举常量 | 说明 |
|--------|----------|-----------|---------|------|
| 000201 | 参数检验失败 | 400 | VALIDATE_FAILED | 请求参数不合法 |

#### 系统内部错误(000501-000599)

| 错误码 | 错误信息 | HTTP状态码 | 枚举常量 | 说明 |
|--------|----------|-----------|---------|------|
| 000501 | 操作失败 | 500 | FAILED | 系统内部错误 |
| 000502 | 系统繁忙，请稍后重试 | 503 | SERVICE_UNAVAILABLE | 服务不可用 |

#### 限流熔断错误(000701-000799)

| 错误码 | 错误信息 | HTTP状态码 | 枚举常量 | 说明 |
|--------|----------|-----------|---------|------|
| 000701 | 请求过于频繁，请稍后重试 | 429 | TOO_MANY_REQUESTS | 触发限流 |
| 000702 | 服务降级中 | 503 | SERVICE_DEGRADED | 熔断保护 |

### 2.2 门诊管理错误码(100000-109999)

#### 患者管理错误(100301-100399)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 100301 | 患者信息不存在 | 404 | PATIENT_NOT_FOUND | 未找到患者记录 |
| 100302 | 患者信息已存在 | 409 | PATIENT_ALREADY_EXISTS | 患者已注册 |

#### 挂号管理错误(100310-100329)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 100310 | 挂号信息不存在 | 404 | REGISTRATION_NOT_FOUND | 未找到挂号记录 |
| 100311 | 该时段号源已满 | 409 | REGISTRATION_FULL | 预约冲突 |
| 100312 | 重复挂号 | 409 | DUPLICATE_REGISTRATION | 同一时段已挂号 |
| 100313 | 挂号已取消，不可操作 | 400 | REGISTRATION_CANCELLED | 状态不允许 |

#### 诊疗管理错误(100330-100349)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 100330 | 诊断记录不存在 | 404 | DIAGNOSIS_NOT_FOUND | 未找到诊断信息 |
| 100331 | 病历模板不存在 | 404 | MEDICAL_RECORD_TEMPLATE_NOT_FOUND | 模板未找到 |

#### 排班管理错误(100350-100369)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 100350 | 医生排班信息不存在 | 404 | SCHEDULE_NOT_FOUND | 排班未配置 |
| 100351 | 排班时间冲突 | 409 | SCHEDULE_CONFLICT | 排班时段重叠 |

### 2.3 药品管理错误码(200000-209999)

#### 药品信息错误(200301-200319)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 200301 | 药品信息不存在 | 404 | DRUG_NOT_FOUND | 未找到药品记录 |
| 200302 | 药品已过期 | 400 | DRUG_EXPIRED | 有效期已过 |
| 200303 | 药品库存不足 | 409 | DRUG_STOCK_INSUFFICIENT | 库存数量不够 |

#### 处方管理错误(200320-200339)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 200320 | 处方不存在 | 404 | PRESCRIPTION_NOT_FOUND | 未找到处方记录 |
| 200321 | 处方已发药，不可修改 | 400 | PRESCRIPTION_DISPENSED | 状态不允许 |
| 200322 | 处方模板不存在 | 404 | PRESCRIPTION_TEMPLATE_NOT_FOUND | 模板未找到 |
| 200323 | 草药处方剂数不合法 | 400 | INVALID_DOSES | 剂数参数错误 |

#### 发药退药错误(200340-200359)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 200340 | 退药数量超过已发数量 | 400 | RETURN_QUANTITY_EXCEEDED | 退药量不合法 |

### 2.4 收费管理错误码(300000-309999)

#### 收费管理错误(300301-300329)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 300301 | 收费记录不存在 | 404 | CHARGE_NOT_FOUND | 未找到收费信息 |
| 300302 | 该费用已结算，不可修改 | 400 | CHARGE_SETTLED | 状态不允许 |
| 300303 | 支付方式不支持 | 400 | PAYMENT_METHOD_NOT_SUPPORTED | 支付类型错误 |

#### 退费管理错误(300330-300349)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 300330 | 退费金额超过实收金额 | 400 | REFUND_AMOUNT_EXCEEDED | 退费金额不合法 |

#### 日结管理错误(300350-300369)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 300350 | 日结记录不存在 | 404 | DAILY_SETTLEMENT_NOT_FOUND | 未找到日结信息 |
| 300351 | 该收费员尚未日结 | 400 | DAILY_SETTLEMENT_NOT_DONE | 操作顺序错误 |

#### 发票管理错误(300370-300389)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 300370 | 发票号不连续 | 400 | INVOICE_NUMBER_DISCONTINUOUS | 发票管理异常 |

### 2.5 系统管理错误码(400000-409999)

#### 用户管理错误(400301-400329)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 400301 | 用户名或密码错误 | 401 | INVALID_CREDENTIALS | 登录凭证错误 |
| 400302 | 用户不存在 | 404 | USER_NOT_FOUND | 未找到用户记录 |
| 400303 | 用户已存在 | 409 | USER_ALREADY_EXISTS | 用户名重复 |
| 400304 | 密码强度不符合要求 | 400 | WEAK_PASSWORD | 密码过于简单 |

#### 角色权限错误(400330-400349)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 400330 | 角色不存在 | 404 | ROLE_NOT_FOUND | 未找到角色 |

#### 科室管理错误(400350-400369)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 400350 | 科室不存在 | 404 | DEPARTMENT_NOT_FOUND | 未找到科室 |

#### 常用项管理错误(400370-400389)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 400370 | 常用项不存在 | 404 | COMMON_ITEM_NOT_FOUND | 未找到常用项 |

### 2.6 第三方服务错误码(900000-909999)

#### OSS服务错误(900601-900619)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 900601 | OSS文件上传失败 | 500 | OSS_UPLOAD_FAILED | 对象存储异常 |
| 900602 | OSS文件删除失败 | 500 | OSS_DELETE_FAILED | 对象存储异常 |

#### 支付服务错误(900620-900639)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 900620 | 支付接口调用失败 | 500 | PAYMENT_API_FAILED | 支付服务异常 |

#### 短信服务错误(900640-900659)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 900640 | 短信发送失败 | 500 | SMS_SEND_FAILED | 短信服务异常 |

#### 通用外部服务错误(900660-900699)

| 错误码 | 错误信息 | HTTP状态码 | 建议枚举常量 | 说明 |
|--------|----------|-----------|------------|------|
| 900660 | 外部接口超时 | 504 | EXTERNAL_API_TIMEOUT | 第三方响应超时 |

---

## 三、旧错误码映射

为保持向后兼容，旧错误码映射关系：

| 原错误码 | 原枚举常量 | 新错误码 | 新枚举常量 | 说明 |
|---------|----------|---------|----------|------|
| 200 | SUCCESS | 000000 | SUCCESS | 操作成功 |
| 401 | UNAUTHORIZED | 000101 | UNAUTHORIZED | 暂未登录或token已经过期 |
| 403 | FORBIDDEN | 000102 | FORBIDDEN | 没有相关权限 |
| 404 | VALIDATE_FAILED | 000201 | VALIDATE_FAILED | 参数检验失败 |
| 500 | FAILED | 000501 | FAILED | 操作失败 |

---

## 四、使用示例

### 4.1 Java代码示例

```java
// 成功响应
return CommonResult.success(data);

// 失败响应 - 使用枚举
return CommonResult.failed(ResultCode.UNAUTHORIZED);

// 失败响应 - 自定义消息
return CommonResult.failed(ResultCode.PATIENT_NOT_FOUND);
```

### 4.2 前端处理示例

```javascript
// 根据错误码处理
if (response.code === 000101) {
    // 跳转到登录页
    router.push('/login');
} else if (response.code === 100301) {
    // 提示患者不存在
    showError('患者信息不存在');
}
```

---

## 五、开发规范

### 5.1 错误码使用规范

1. **新增错误码**：必须先在本文档定义，再在ResultCode枚举中添加
2. **错误码选择**：优先使用已有错误码，避免重复定义
3. **错误信息**：应清晰描述问题，不包含敏感信息
4. **HTTP状态码**：必须与错误类型匹配
5. **文档同步**：代码变更时同步更新本文档

### 5.2 错误处理最佳实践

1. **统一返回格式**：所有接口使用CommonResult包装返回
2. **日志记录**：记录完整的错误码和堆栈信息
3. **异常转换**：将Java异常转换为业务错误码
4. **前端适配**：提供清晰的错误码文档给前端团队

---

## 六、附录

### 6.1 HTTP状态码说明

| HTTP状态码 | 含义 | 使用场景 |
|-----------|------|---------|
| 200 | OK | 请求成功 |
| 400 | Bad Request | 客户端请求参数错误 |
| 401 | Unauthorized | 未认证 |
| 403 | Forbidden | 已认证但无权限 |
| 404 | Not Found | 资源不存在 |
| 409 | Conflict | 资源冲突 |
| 429 | Too Many Requests | 请求过于频繁 |
| 500 | Internal Server Error | 服务器内部错误 |
| 503 | Service Unavailable | 服务不可用 |
| 504 | Gateway Timeout | 网关超时 |

### 6.2 文档维护

| 维护活动 | 频率 | 责任人 |
|---------|------|--------|
| 日常更新 | 新增业务功能时 | 功能开发人员 |
| 定期Review | 每月 | 技术负责人 |
| 版本发布 | 每季度 | 团队Leader |

### 6.3 变更历史

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| v1.0.0 | 2025-11-03 | 初始版本 | 后端开发团队 |

---

**文档结束**
