# HIS系统后端错误码参考文档

## 文档信息
- **版本**：v1.0.0
- **更新时间**：2025-11-03
- **适用系统**：HIS后端（HIS-master / his-cloud）
- **维护团队**：后端开发团队

---

## 一、错误码规范

### 1.1 错误码结构

采用分层分段的错误码结构，便于快速定位问题来源：

| 字段 | 位数 | 说明 | 示例 |
|------|------|------|------|
| 完整错误码 | 6位 | 整体结构 | 100001 |
| 模块码 | 前2位 | 标识所属业务模块 | 10 |
| 分类码 | 中2位 | 标识错误类型分类 | 00 |
| 序号码 | 后2位 | 同类错误的序号 | 01 |

**示例解析**：错误码 `100301` 表示：
- `10`：门诊管理模块(PMS)
- `03`：业务逻辑错误
- `01`：该类别下的第1个错误

### 1.2 模块码说明

| 模块码 | 模块名称 | 说明 | 适用范围 |
|--------|----------|------|----------|
| 00 | 系统通用 | 系统级通用错误 | 所有模块 |
| 10 | 门诊管理(PMS) | 患者管理、挂号、诊疗 | HIS-pms-service |
| 20 | 药品管理(DMS) | 药品、处方、药房 | HIS-dms-service |
| 30 | 收费管理(BMS) | 收费、对账、退费 | HIS-bms-service |
| 40 | 系统管理(SMS) | 用户、权限、科室、排班 | HIS-sms-service |
| 50 | 网关服务 | API网关、路由 | his-cloud-zuul |
| 90 | 第三方集成 | OSS、支付、短信等外部服务 | 各service |

### 1.3 分类码说明

| 分类码 | 分类名称 | 说明 | 示例场景 |
|--------|----------|------|----------|
| 00 | 成功 | 操作成功 | 正常业务流程 |
| 01 | 认证授权错误 | 登录、权限相关 | 未登录、token过期、无权限 |
| 02 | 参数校验错误 | 请求参数不合法 | 必填参数缺失、格式错误 |
| 03 | 业务逻辑错误 | 业务规则校验失败 | 库存不足、重复挂号 |
| 04 | 数据访问错误 | 数据库操作异常 | 数据不存在、查询失败 |
| 05 | 系统内部错误 | 服务器内部异常 | 空指针、运行时异常 |
| 06 | 外部服务错误 | 调用第三方服务失败 | OSS上传失败、支付接口超时 |
| 07 | 限流熔断错误 | 系统保护机制触发 | 请求过频、服务降级 |

---

## 二、错误码快速索引

- [系统通用错误码(00xxxx)](#系统通用错误码00xxxx)
- [门诊管理错误码(10xxxx)](#门诊管理错误码10xxxx)
- [药品管理错误码(20xxxx)](#药品管理错误码20xxxx)
- [收费管理错误码(30xxxx)](#收费管理错误码30xxxx)
- [系统管理错误码(40xxxx)](#系统管理错误码40xxxx)
- [网关服务错误码(50xxxx)](#网关服务错误码50xxxx)
- [第三方服务错误码(90xxxx)](#第三方服务错误码90xxxx)

---

## 三、详细错误码列表

### 系统通用错误码(00xxxx)

#### 成功状态

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 000000 | 操作成功 | 200 | 请求处理成功 | 正常业务流程 |

#### 认证授权错误(000101-000199)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 000101 | 暂未登录或token已经过期 | 401 | 认证失败，用户未登录或token失效 | 重新登录获取token |
| 000102 | 没有相关权限 | 403 | 授权失败，用户无操作权限 | 联系管理员分配权限 |

#### 参数校验错误(000201-000299)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 000201 | 参数检验失败 | 400 | 请求参数不合法或缺失 | 检查参数格式和必填项 |

#### 系统内部错误(000501-000599)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 000501 | 操作失败 | 500 | 系统内部错误 | 查看日志排查问题 |
| 000502 | 系统繁忙，请稍后重试 | 503 | 服务不可用 | 稍后重试 |

#### 限流熔断错误(000701-000799)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 000701 | 请求过于频繁，请稍后重试 | 429 | 触发限流保护 | 降低请求频率 |
| 000702 | 服务降级中 | 503 | 熔断保护激活 | 等待服务恢复 |

---

### 门诊管理错误码(10xxxx)

#### 业务逻辑错误(100301-100399)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 100301 | 患者信息不存在 | 404 | 未找到患者记录 | 确认患者ID正确性 |
| 100302 | 挂号信息不存在 | 404 | 未找到挂号记录 | 确认挂号ID正确性 |
| 100303 | 该时段号源已满 | 409 | 预约冲突，号源已用完 | 选择其他时段 |
| 100304 | 重复挂号 | 409 | 同一时段已存在挂号 | 避免重复操作 |
| 100305 | 诊断记录不存在 | 404 | 未找到诊断信息 | 确认记录ID正确性 |
| 100306 | 病历模板不存在 | 404 | 模板未找到 | 联系管理员配置模板 |
| 100307 | 医生排班信息不存在 | 404 | 排班未配置 | 联系管理员配置排班 |
| 100308 | 挂号已取消，不可操作 | 400 | 状态不允许，挂号已取消 | 检查挂号状态 |

---

### 药品管理错误码(20xxxx)

#### 业务逻辑错误(200301-200399)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 200301 | 药品信息不存在 | 404 | 未找到药品记录 | 确认药品ID正确性 |
| 200302 | 处方不存在 | 404 | 未找到处方记录 | 确认处方ID正确性 |
| 200303 | 药品库存不足 | 409 | 库存数量不够 | 减少开药数量或补充库存 |
| 200304 | 处方已发药，不可修改 | 400 | 状态不允许，处方已发药 | 检查处方状态 |
| 200305 | 处方模板不存在 | 404 | 模板未找到 | 联系管理员配置模板 |
| 200306 | 药品已过期 | 400 | 有效期已过 | 下架过期药品 |
| 200307 | 退药数量超过已发数量 | 400 | 退药量不合法 | 调整退药数量 |
| 200308 | 草药处方剂数不合法 | 400 | 剂数参数错误 | 检查剂数参数 |

---

### 收费管理错误码(30xxxx)

#### 业务逻辑错误(300301-300399)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 300301 | 收费记录不存在 | 404 | 未找到收费信息 | 确认记录ID正确性 |
| 300302 | 该费用已结算，不可修改 | 400 | 状态不允许，费用已结算 | 检查费用状态 |
| 300303 | 退费金额超过实收金额 | 400 | 退费金额不合法 | 调整退费金额 |
| 300304 | 日结记录不存在 | 404 | 未找到日结信息 | 确认日期正确性 |
| 300305 | 该收费员尚未日结 | 400 | 操作顺序错误 | 先完成日结操作 |
| 300306 | 发票号不连续 | 400 | 发票管理异常 | 检查发票使用情况 |
| 300307 | 支付方式不支持 | 400 | 支付类型错误 | 选择支持的支付方式 |

---

### 系统管理错误码(40xxxx)

#### 认证错误(400101-400199)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 400301 | 用户名或密码错误 | 401 | 登录凭证错误 | 检查用户名密码 |

#### 业务逻辑错误(400301-400399)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 400302 | 用户不存在 | 404 | 未找到用户记录 | 确认用户ID正确性 |
| 400303 | 用户已存在 | 409 | 用户名重复 | 更换用户名 |
| 400304 | 角色不存在 | 404 | 未找到角色 | 确认角色ID正确性 |
| 400305 | 科室不存在 | 404 | 未找到科室 | 确认科室ID正确性 |
| 400306 | 排班时间冲突 | 409 | 排班时段重叠 | 调整排班时间 |
| 400307 | 常用项不存在 | 404 | 未找到常用项 | 确认常用项ID正确性 |
| 400308 | 密码强度不符合要求 | 400 | 密码过于简单 | 设置更复杂的密码 |

---

### 网关服务错误码(50xxxx)

#### 网关错误(500101-500199)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 500101 | 服务路由失败 | 502 | 无法路由到目标服务 | 检查服务注册状态 |
| 500102 | 服务超时 | 504 | 下游服务响应超时 | 检查服务性能或增加超时时间 |
| 500103 | 服务不可用 | 503 | 目标服务不可用 | 检查服务健康状态 |

---

### 第三方服务错误码(90xxxx)

#### 外部服务错误(900601-900699)

| 错误码 | 错误信息 | HTTP状态码 | 说明 | 处理建议 |
|--------|----------|-----------|------|----------|
| 900601 | OSS文件上传失败 | 500 | 对象存储异常 | 检查OSS配置和网络 |
| 900602 | OSS文件删除失败 | 500 | 对象存储异常 | 检查OSS配置和权限 |
| 900603 | 支付接口调用失败 | 500 | 支付服务异常 | 检查支付接口配置 |
| 900604 | 短信发送失败 | 500 | 短信服务异常 | 检查短信服务配置 |
| 900605 | 外部接口超时 | 504 | 第三方响应超时 | 增加超时时间或重试 |

---

## 四、旧错误码映射表

为保持向后兼容，旧错误码映射到新规范：

| 原错误码 | 原描述 | 新错误码 | 映射说明 |
|---------|--------|---------|---------|
| 200 | 操作成功 | 000000 | 系统通用-成功 |
| 401 | 暂未登录或token已经过期 | 000101 | 系统通用-认证失败 |
| 403 | 没有相关权限 | 000102 | 系统通用-授权失败 |
| 404 | 参数检验失败 | 000201 | 系统通用-参数错误 |
| 500 | 操作失败 | 000501 | 系统通用-系统错误 |

---

## 五、附录

### 5.1 HTTP状态码对照表

| HTTP状态码 | 含义 | 使用场景 |
|-----------|------|---------|
| 200 | OK | 请求成功 |
| 400 | Bad Request | 客户端请求参数错误 |
| 401 | Unauthorized | 未认证 |
| 403 | Forbidden | 已认证但无权限 |
| 404 | Not Found | 资源不存在 |
| 409 | Conflict | 资源冲突 |
| 429 | Too Many Requests | 请求过于频繁 |
| 500 | Internal Server Error | 服务器内部错误 |
| 502 | Bad Gateway | 网关错误 |
| 503 | Service Unavailable | 服务不可用 |
| 504 | Gateway Timeout | 网关超时 |

### 5.2 错误响应格式

所有接口错误响应遵循统一格式：

```json
{
  "code": 100301,
  "message": "患者信息不存在",
  "data": null
}
```

### 5.3 错误处理最佳实践

#### 开发规范

1. **新增错误码**：必须先在错误码文档中定义，再在代码中实现
2. **错误码选择**：优先使用已有错误码，确实需要时才新增
3. **错误信息**：错误信息应清晰描述问题，不包含敏感信息
4. **HTTP状态码**：必须与错误类型匹配，遵循RESTful规范
5. **文档同步**：代码变更时同步更新错误码文档

#### 使用建议

1. **前端处理**：根据错误码进行精准的错误提示和页面跳转
2. **日志记录**：记录完整的错误码和上下文信息便于排查
3. **监控告警**：对关键错误码设置监控告警
4. **文档查阅**：遇到错误码时查阅本文档了解详细信息

---

## 六、文档维护

### 维护机制

| 维护活动 | 频率 | 责任人 | 检查内容 |
|---------|------|--------|---------|
| 日常更新 | 新增业务功能时 | 功能开发人员 | 补充新增错误码 |
| 定期Review | 每月 | 技术负责人 | 检查文档完整性 |
| 版本发布 | 每季度 | 团队Leader | 发布正式版本文档 |
| 存量清理 | 每半年 | 技术负责人 | 清理废弃错误码 |

### 变更历史

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|---------|--------|
| v1.0.0 | 2025-11-03 | 初始版本，建立错误码规范和基础错误码 | 后端开发团队 |

---

**文档结束**
